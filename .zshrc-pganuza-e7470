#!/bin/zsh
#########################################################
# PGANUZA-E7470
#
# TODO.TXT stuff
source $HOME/.local/bin/todo_completion
alias tp='todo.sh -a -d ~/.todo.cfg##personal'
alias rm='trash'

#export JAVA_HOME="/usr/java/jdk1.8.0_73/"
export LD_LIBRARY_PATH=/usr/lib/oracle/12.2/client64/lib:$LD_LIBRARY_PATH

# Corporate mounts
alias mount-home="sudo mount.cifs -o user=pganuza,domain=ASSIA-INC,uid=1000,gid=1000,vers=1.0 //rc-netapp02a.assia-inc.com/home/pganuza /mnt/home"
alias mount-corp="sudo mount.cifs -o user=pganuza,domain=ASSIA-INC,uid=1000,gid=1000,vers=1.0 //rc-netapp02a.assia-inc.com/corp /mnt/corp"

# Backup important work info into external HDD
alias backup-pganuza-e7470="rsync -avh --delete-after ~/.* ~/Plantillas ~/Software ~/Trabajo ~/Workspace/system-level_test_plan ~/Workspace/drafts  /run/media/pganuza/pganuza-backups/"

# Show what I have done since last report
scrum_report() {
	if [ "$#" -ne 1 ]; then
		days_to_report=1
	else 
		days_to_report=$1
	fi
	echo "Scrum report since day: $(date --date="$1 days ago")"

	echo "\n================== COMPLETED TASKS =================="
	ommited_tags='@scrum|@qa-meeting'
	for d ({$days_to_report..0}) do
		grep -E "^x $(date --iso-8601 --date="$d days ago")" ~/.todo-txt/trabajo-done.txt ~/.todo-txt/trabajo-todo.txt | grep -Ev $ommited_tags | sed 's/.*:x //g'
	done

	echo "\n===================== COMMITS ======================="
	# Execute a command from another directory [1]
	( cd ~/Workspace/expresse/dsloExpresse/ ; cvs log -d \>"$days_to_report day ago" 2>/dev/null | grep "author: pganuza" -A1 | grep "DSLE-" | sort| uniq )
	( cd ~/Workspace/expresse/dsloExpresseAdditional/ ; cvs log -d \>"$days_to_report day ago" 2>/dev/null | grep "author: pganuza" -A1 | grep "QA-" | sort| uniq )
	( cd ~/Workspace/expresse/GuiWebServiceProject/ ; cvs log -d \>"$days_to_report day ago" 2>/dev/null | grep "author: pganuza" -A1 | grep "DSLE-" | sort| uniq )

	echo "\n================= OTHER THINGS DONE ================="
	jrnl -from "\"$days_to_report days ago at 15:50\""

	echo "================== THINGS TO TELL ==================="
	t ls @scrum | head -n -2
}

# Add an event to work calendar [3]
addics() {
	if [ "$#" -ne 1 ]; then
		echo 1>&2 "*** Usage: $0 [event.ics]"
		return 2
	fi 
	echo -n "Please provide password: "
	stty_orig=`stty -g` # save original terminal setting.
	stty -echo          # turn-off echoing.
	read passwd         # read the password
	stty $stty_orig     # restore terminal setting.
	ics_file=$1

	sed '/METHOD/d' $ics_file | python $HOME/.scripts/calendar-cli.py --caldav-url="https://guaranuzas.com/nextcloud/remote.php/" --calendar-url="dav/calendars/pablo/trabajo/" --caldav-user=pablo --caldav-pass="$passwd" calendar addics
}

# Add some useful paths to the hotlist for n-cd
znt_cd_hotlist=( "${znt_cd_hotlist[@]}" '=====================================pganuza-e7470rc====' )
znt_cd_hotlist=( "${znt_cd_hotlist[@]}" '~/Trabajo/KnowHow/wiki' '~/Workspace/expresse/dsloExpresse/releases' '~/Workspace/system_level_test_plan/' '~/Workspace/qa/naming_conventions_test/' '~/Trabajo/Releases/QA' )

# Currently working
znt_cd_hotlist=( "${znt_cd_hotlist[@]}" '------------------------------------=currently working=-' )
znt_cd_hotlist=( "${znt_cd_hotlist[@]}" '~/Trabajo/Releases/Generic/G-5.3.2' )
znt_cd_hotlist=( "${znt_cd_hotlist[@]}" '~/Trabajo/Releases/Telef√≥nica Colombia/TC-5.3.2' )
znt_cd_hotlist=( "${znt_cd_hotlist[@]}" '~/Trabajo/Releases/TeData/TD-5.3.2.3' )

# Just throw a fast query 
alias query='sqlturbo.py -u $DB -f $DBF'

################################################
# SOURCES
# [1] https://superuser.com/questions/271986/execute-a-command-from-another-directory-in-bash#271992
